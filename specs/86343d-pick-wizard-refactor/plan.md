---
runId: 86343d
feature: pick-wizard-refactor
created: 2025-01-21
status: ready
---

# Feature: Pick Wizard Component Refactoring - Implementation Plan

> **Generated by:** Task Decomposition skill
> **From spec:** specs/86343d-pick-wizard-refactor/spec.md
> **Created:** 2025-01-21

## Execution Summary

- **Total Tasks**: 4
- **Total Phases**: 3
- **Sequential Time**: 19h
- **Parallel Time**: 15.5h
- **Time Savings**: 3.5h (18% faster)

**Parallel Opportunities:**
- Phase 1: 2 tasks in parallel (3.5h saved)

**Task Breakdown:**
- L (5-8h): 1 task
- M (2-5h): 3 tasks
- S (1-2h): 0 tasks

---

## Phase 1: Foundation Layer

**Strategy**: Parallel
**Reason**: UI components and hooks are independent - no shared files, can be built simultaneously

### Task 1: shadcn/ui Foundation Setup

**Files**:
- `components.json` (new)
- `package.json` (modified - add dependencies)
- `src/components/ui/card.tsx` (generated)
- `src/components/ui/button.tsx` (generated)
- `src/components/ui/badge.tsx` (generated + custom variants)
- `src/components/ui/alert.tsx` (generated + custom variant)
- `src/components/ui/separator.tsx` (generated)
- `src/components/ui/scroll-area.tsx` (generated)

**Complexity**: M (3-4h)

**Dependencies**: None

**Description**:
Install and configure shadcn/ui design system for BigNight.Party. Generate all required UI primitives and add custom variants for success/warning states. This establishes the presentational layer foundation that feature components will consume.

**Implementation Steps**:

1. Install shadcn CLI and lucide-react dependencies
   ```bash
   pnpm add lucide-react
   pnpm dlx shadcn@latest init
   ```

2. Configure `components.json` for Tailwind v4 compatibility
   - Verify config matches project structure (`src/components/ui/`)
   - Ensure TypeScript paths align with tsconfig

3. Generate base UI components using shadcn CLI
   ```bash
   pnpm dlx shadcn@latest add card button badge alert separator scroll-area
   ```

4. Add custom Badge variants in `src/components/ui/badge.tsx`
   - Add `success` variant (green color scheme)
   - Add `warning` variant (yellow/amber color scheme)
   - Follow Tailwind v4 color palette

5. Add custom Alert variant in `src/components/ui/alert.tsx`
   - Add `warning` variant (yellow/amber color scheme)
   - Ensure consistent with Badge warning colors

6. Verify all components render correctly
   - Run dev server: `pnpm dev`
   - Check for TypeScript errors
   - Run linter: `pnpm lint`

**Acceptance Criteria**:
- [ ] shadcn CLI configured with `components.json`
- [ ] All 6 UI components generated in `src/components/ui/`
- [ ] Custom Badge variants (success, warning) added and typed correctly
- [ ] Custom Alert variant (warning) added and typed correctly
- [ ] lucide-react installed and importable
- [ ] No TypeScript errors or linting issues
- [ ] All components compatible with Tailwind v4

**Mandatory Patterns**:

> **Constitution**: All code must follow CLAUDE.md and project patterns

- Use Tailwind v4 color utilities (no deprecated v3 syntax)
- TypeScript strict mode enabled (no `any` types)
- Biome linting passes

**Quality Gates**:
```bash
pnpm lint
pnpm dev  # Verify no build errors
```

---

### Task 2: Custom Hooks Layer

**Files**:
- `src/hooks/game/usePickNavigation.ts` (new)
- `src/hooks/game/usePickSubmission.ts` (new)
- `src/hooks/game/useSaveIndicator.ts` (new)

**Complexity**: M (4-5h)

**Dependencies**: None

**Description**:
Extract all business logic from the monolithic pick-wizard component into three focused custom hooks. These hooks encapsulate stateful logic (navigation, submission, save status) while remaining testable in isolation. Hooks must return focused interfaces and contain zero JSX per CLAUDE.md patterns.

**Implementation Steps**:

1. Create `src/hooks/game/usePickNavigation.ts`
   - Accept categories array and initial category ID
   - Track current category index in state
   - Implement `navigateToCategory(categoryId)` handler
   - Implement `handlePrevious()` and `handleNext()` handlers
   - Return `{ currentCategoryId, navigateToCategory, handlePrevious, handleNext, hasPrevious, hasNext }`
   - Use `useMemo` to compute derived state (hasPrevious, hasNext)

2. Create `src/hooks/game/usePickSubmission.ts`
   - Accept game ID, existing picks map, and submitPickAction
   - Track optimistic UI state (selectedNominationId per category)
   - Implement `handleSelect(categoryId, nominationId)` handler
   - Call submitPickAction and update optimistic state
   - Return `{ selectedNominationId, handleSelect, completedCategoryIds }`
   - Use `useOptimistic` or `useState` + `useTransition` for pending state

3. Create `src/hooks/game/useSaveIndicator.ts`
   - Track save status: 'idle' | 'saving' | 'saved'
   - Implement `setSaving()` and `setSaved()` helpers
   - Auto-reset to 'idle' after 2 seconds when status changes to 'saved'
   - Return `{ status, setSaving, setSaved, reset }`
   - Use `useEffect` with cleanup for auto-reset timer

4. Add TypeScript types for all hook interfaces
   - Define return types explicitly (no inference)
   - Use discriminated unions for status ('idle' | 'saving' | 'saved')
   - Export all types from each hook file

5. Verify hooks follow React rules
   - All hooks start with `use` prefix
   - No conditional hook calls
   - All dependencies in useEffect/useMemo arrays
   - No JSX returned (pure logic only)

6. Run linter and type checking
   ```bash
   pnpm lint
   ```

**Acceptance Criteria**:
- [ ] `usePickNavigation` handles category navigation with prev/next logic
- [ ] `usePickSubmission` manages optimistic UI updates for pick selection
- [ ] `useSaveIndicator` auto-resets status to idle after 2 seconds
- [ ] All hooks return focused interfaces (no god objects)
- [ ] Zero JSX in hooks (pure logic only per CLAUDE.md)
- [ ] All TypeScript types explicitly defined and exported
- [ ] Hooks follow React rules (no conditional calls, proper deps)
- [ ] Linting passes with no errors

**Mandatory Patterns**:

> **Constitution**: Hooks are pure logic - no JSX (CLAUDE.md)

- Hooks must not return JSX (components-only responsibility)
- Use discriminated unions for state (`'idle' | 'saving' | 'saved'`)
- All hook return values explicitly typed

**Quality Gates**:
```bash
pnpm lint
```

---

## Phase 2: Feature Component Layer

**Strategy**: Sequential
**Reason**: Feature components depend on both UI components (Phase 1, Task 1) and hooks (Phase 1, Task 2)

### Task 3: Feature-Slice Components

**Files**:
- `src/components/game/pick-wizard/category-sidebar.tsx` (new)
- `src/components/game/pick-wizard/nomination-list.tsx` (new)
- `src/components/game/pick-wizard/pick-progress-tracker.tsx` (new)
- `src/components/game/pick-wizard/pick-status-banner.tsx` (new)
- `src/components/game/pick-wizard/wizard-navigation.tsx` (new)
- `src/components/game/pick-wizard/save-indicator.tsx` (new)
- `src/components/game/nominee-card.tsx` (modified)

**Complexity**: L (6-7h)

**Dependencies**: [task-1, task-2]

**Dependency Reason**: Imports UI components from Task 1 (Card, Button, Badge, Alert, ScrollArea, Separator) and hooks from Task 2 (usePickNavigation, usePickSubmission, useSaveIndicator)

**Description**:
Create all feature-slice components that compose the pick wizard UI. Each component is focused on a single responsibility and uses shadcn/ui primitives. Components receive focused props (no god objects) and delegate logic to hooks. Also refactor NomineeCard to use shadcn Card instead of raw divs.

**Implementation Steps**:

1. Create `src/components/game/pick-wizard/category-sidebar.tsx`
   - Accept `categories`, `currentCategoryId`, `completedCategoryIds`, `onCategorySelect`
   - Use `ScrollArea` from shadcn for scrollable list
   - Use `Button` variant for each category item
   - Show checkmark icon (lucide-react `Check`) for completed categories
   - Highlight current category with different variant
   - Add `"use client"` directive (needs onClick handlers)

2. Create `src/components/game/pick-wizard/nomination-list.tsx`
   - Accept `nominations`, `selectedNominationId`, `onSelect`, `isLocked`
   - Render grid of `NomineeCard` components
   - Pass selection state and handlers to each card
   - Use responsive grid (mobile: 1 col, tablet: 2 col, desktop: 3 col)
   - Add `"use client"` directive (needs onClick handlers)

3. Create `src/components/game/pick-wizard/pick-progress-tracker.tsx`
   - Accept `categories`, `currentCategoryId`, `completedCategoryIds`, `onCategorySelect`
   - Render horizontal stepper with `Button` for each category
   - Use lucide-react icons: `Check` for completed, number for pending
   - Hide on mobile (show sidebar instead)
   - Add `"use client"` directive (needs onClick handlers)

4. Create `src/components/game/pick-wizard/pick-status-banner.tsx`
   - Accept `isLocked`, `locksAt`, `status` (from game)
   - Use `Alert` component with `warning` variant
   - Show lock icon (lucide-react `Lock`) and warning message
   - Conditionally render based on lock state
   - Server Component (no client interactions)

5. Create `src/components/game/pick-wizard/wizard-navigation.tsx`
   - Accept `onPrevious`, `onNext`, `hasPrevious`, `hasNext`
   - Use `Button` with lucide-react icons (`ChevronLeft`, `ChevronRight`)
   - Disable buttons when at boundaries
   - Add `"use client"` directive (needs onClick handlers)

6. Create `src/components/game/pick-wizard/save-indicator.tsx`
   - Accept `status` ('idle' | 'saving' | 'saved')
   - Use `Badge` component with variants (default for saving, success for saved)
   - Show lucide-react icons: `Loader2` (spinning) for saving, `Check` for saved
   - Hide when status is 'idle'
   - Server Component (no client interactions)

7. Refactor `src/components/game/nominee-card.tsx`
   - Replace raw divs with shadcn `Card` and `CardContent`
   - Keep existing props interface unchanged
   - Use `Button` for selectable cards
   - Show selection state with border highlight or checkmark
   - Add `"use client"` directive (needs onClick handler)
   - Keep image rendering with Next.js Image component

8. Verify all components
   - Each component < 150 lines (per acceptance criteria)
   - Focused props (no god objects)
   - Proper Server/Client boundaries (`"use client"` only where needed)
   - Run linter: `pnpm lint`

**Acceptance Criteria**:
- [ ] CategorySidebar renders scrollable list with completion indicators
- [ ] NominationList renders responsive grid of NomineeCard components
- [ ] PickProgressTracker shows horizontal stepper (hidden on mobile)
- [ ] PickStatusBanner shows lock warnings with Alert component
- [ ] WizardNavigation provides prev/next buttons with proper disabled state
- [ ] SaveIndicator displays saving/saved status with icons
- [ ] NomineeCard refactored to use shadcn Card/CardContent
- [ ] All components use lucide-react icons (no raw SVGs)
- [ ] All components < 150 lines each
- [ ] Proper `"use client"` directives (only where needed)
- [ ] No business logic in components (delegated to hooks)
- [ ] Linting passes with no errors

**Mandatory Patterns**:

> **Constitution**: Follow Server/Client boundaries (CLAUDE.md)

- Server Components (default): PickStatusBanner, SaveIndicator
- Client Components (`"use client"`): CategorySidebar, NominationList, PickProgressTracker, WizardNavigation, NomineeCard
- Components receive focused props (no god objects)
- No business logic in components (use hooks)

**Quality Gates**:
```bash
pnpm lint
pnpm dev  # Verify components render without errors
```

---

## Phase 3: Integration & Migration

**Strategy**: Sequential
**Reason**: Orchestrator depends on hooks (Task 2) and feature components (Task 3)

### Task 4: Main PickWizard Orchestrator & Integration

**Files**:
- `src/components/game/pick-wizard/index.tsx` (new)
- `src/app/game/[gameId]/pick/page.tsx` (modified)
- `src/components/PickForm.tsx` (deleted)
- `src/components/pick-wizard.tsx` (deleted)
- `src/components/category-progress-stepper.tsx` (deleted)

**Complexity**: M (4-5h)

**Dependencies**: [task-2, task-3]

**Dependency Reason**: Imports hooks from Task 2 (usePickNavigation, usePickSubmission, useSaveIndicator) and feature components from Task 3 (all pick-wizard/* components)

**Description**:
Create the main PickWizard orchestrator that composes all feature-slice components and custom hooks. Update the page to import the new component. Delete legacy components (PickForm, old pick-wizard, category-progress-stepper). Perform end-to-end verification to ensure feature parity with the original monolithic component.

**Implementation Steps**:

1. Create `src/components/game/pick-wizard/index.tsx`
   - Add `"use client"` directive (orchestrates client components)
   - Accept props: `game`, `categories`, `nominations`, `existingPicks`
   - Consume `usePickNavigation` hook
   - Consume `usePickSubmission` hook with submitPickAction
   - Consume `useSaveIndicator` hook
   - Compose layout:
     - PickStatusBanner at top (conditional on lock state)
     - PickProgressTracker below banner (desktop only)
     - CategorySidebar on left (mobile: toggle, desktop: always visible)
     - NominationList in center (current category's nominations)
     - WizardNavigation at bottom
     - SaveIndicator floating (top-right corner)
   - Handle mobile sidebar toggle state
   - Keep layout structure similar to original (maintain UX)

2. Update `src/app/game/[gameId]/pick/page.tsx`
   - Change import from `'@/components/pick-wizard'` to `'@/components/game/pick-wizard'`
   - No other changes (Server Component data fetching unchanged)
   - Verify props passed to PickWizard match new interface

3. Delete legacy components
   ```bash
   rm src/components/PickForm.tsx
   rm src/components/pick-wizard.tsx
   rm src/components/category-progress-stepper.tsx
   ```

4. End-to-end verification
   - Start dev server: `pnpm dev`
   - Navigate to `/game/[gameId]/pick` route
   - Test category navigation (prev/next/direct selection)
   - Test nomination selection (optimistic UI updates)
   - Test save indicator (saving → saved → idle)
   - Test lock warnings (if applicable)
   - Test mobile sidebar toggle
   - Verify progress tracking (completed categories)
   - Check browser console for errors
   - Test responsive layout (mobile, tablet, desktop)

5. Run all quality gates
   ```bash
   pnpm lint
   pnpm build  # Verify production build succeeds
   ```

**Acceptance Criteria**:
- [ ] PickWizard orchestrator composes all feature components correctly
- [ ] All hooks integrated and working (navigation, submission, save indicator)
- [ ] Page.tsx updated to import new PickWizard (no other changes)
- [ ] Legacy components deleted (PickForm, pick-wizard, category-progress-stepper)
- [ ] Category navigation works (prev/next/direct selection)
- [ ] Pick submission with optimistic UI updates works
- [ ] Save indicators display correctly (saving → saved → idle)
- [ ] Lock warnings show at appropriate times
- [ ] Mobile sidebar toggle works
- [ ] Progress tracking displays completed categories
- [ ] No console errors or warnings in browser
- [ ] Mobile responsive layout works (tested on mobile, tablet, desktop)
- [ ] Linting passes and production build succeeds

**Mandatory Patterns**:

> **Constitution**: Follow Server/Client boundaries and centralized routes (CLAUDE.md)

- PickWizard is a Client Component (`"use client"`)
- Page.tsx remains Server Component (data fetching unchanged)
- Use centralized routes from `src/lib/routes.ts` if any navigation added
- No hardcoded route strings

**Quality Gates**:
```bash
pnpm lint
pnpm build
pnpm dev  # Manual end-to-end testing
```

**End-to-End Verification Checklist**:
- [ ] Category navigation: Previous button works
- [ ] Category navigation: Next button works
- [ ] Category navigation: Direct category selection from sidebar works
- [ ] Category navigation: Buttons disabled at boundaries
- [ ] Nomination selection: Clicking nominee selects it
- [ ] Nomination selection: Selection persists when navigating categories
- [ ] Nomination selection: Optimistic UI updates immediately
- [ ] Save indicator: Shows "saving" when submitting pick
- [ ] Save indicator: Shows "saved" after successful submission
- [ ] Save indicator: Resets to idle after 2 seconds
- [ ] Lock warnings: Banner shows when picks are locked
- [ ] Lock warnings: Lock icon displays
- [ ] Mobile: Sidebar toggles on/off
- [ ] Mobile: Single column layout for nominations
- [ ] Desktop: Sidebar always visible
- [ ] Desktop: Multi-column grid for nominations
- [ ] Progress: Completed categories show checkmarks
- [ ] Progress: Current category highlighted
- [ ] No TypeScript errors in build
- [ ] No console errors in browser
- [ ] No console warnings in browser

---

## Project Constitution

> **CRITICAL**: All tasks must follow CLAUDE.md and project architecture patterns

**Mandatory Patterns**:
- Centralized routes: Use `src/lib/routes.ts` for all navigation (no hardcoded strings)
- Server/Client boundaries: Server Components for data, Client Components for interactivity
- Type safety: No `as` assertions without validation (use Zod or type guards)
- Hooks: Pure logic only, zero JSX (components-only responsibility)

**Quality Standards**:
- TypeScript strict mode (no `any` types)
- Biome linting passes
- Component files < 150 lines
- Hook files < 100 lines
- Focused interfaces (no god objects)

**Architecture**:
- Layer boundaries: UI Components → Hooks → (existing Actions/Services/Models)
- This refactor only touches UI and Hooks layers
- No changes to Server Actions, Services, or Models
- No schema changes (zero database migration risk)

---

## Execution Notes

**Parallel Execution**:
- Phase 1 tasks (shadcn setup + hooks) can run in parallel using `/execute` with git worktrees
- This saves 3.5h of development time (44% faster for Phase 1)

**Risk Mitigation**:
- No schema changes: Zero database migration risk
- Server Component (page.tsx) unchanged: Data fetching identical
- Feature parity required: Verify all functionality before deleting legacy components
- Can test new components alongside old: Update page.tsx import only when ready

**Testing**:
- Manual end-to-end testing required (Task 4 acceptance criteria)
- Unit tests for hooks recommended but not required for this refactor
- Component tests recommended but not required for this refactor
- See spec.md "Testing Strategy" section for future test implementation

---

## Next Steps

**Review this plan**:
```bash
cat specs/86343d-pick-wizard-refactor/plan.md
```

**Execute the plan**:
```bash
/execute @specs/86343d-pick-wizard-refactor/plan.md
```

The `/execute` command will:
1. Create git-spice stacked branches for each task
2. Use git worktrees to isolate parallel tasks (Phase 1)
3. Run Phase 1 tasks in parallel (3.5h savings)
4. Execute Phases 2-3 sequentially after Phase 1 completes
5. Create PRs for each completed task

**Modify plan if needed**:
Edit this file directly, then run `/execute @specs/86343d-pick-wizard-refactor/plan.md`
